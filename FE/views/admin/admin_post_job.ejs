<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow" />
    <link rel="icon" href="/images/img/icon_head.png">
    <title>Danh sách ứng viên</title>
    <link rel="preload" href="/css/admin/admin_post_job.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="/css/admin/admin_post_job.css">
    </noscript>
    <link rel="preload" href="/css/common.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="/css/common.css">
    </noscript>
    <link rel="preload" href="/css/admin/leftnav_admin.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="/css/admin/leftnav_admin.css">
    </noscript>
    <link rel="preload" href="/css/custom_select2.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="/css/custom_select2.css">
    </noscript>
</head>
<body>
    <div class="cnt">
        <div class="cnt-left" id="leftNav">
            <%- include('../layouts/leftnav_admin', {}); %>
        </div>
        <div class="cnt-right" id="rightContent">
            <div class="regis-new-candi-container">
                <div class="regis-candi-title fs-4 pt-4 mb-3"><b>Đăng tin tuyển dụng</b></div>
                <div class="notify-line mb-3">
                    Những ô dấu sao <span class="color-alert">(*)</span> là bắt buộc phải nhập.
                </div>
                <div class="form-add">
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="emp_id">
                                <span class="color-alert">*</span> ID công ty :
                            </label>
                        </div>
                        <input id="emp_id" placeholder="Nhập Id công ty" type="text">
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="job_title">
                                <span class="color-alert">*</span> Tiêu đề tin :
                            </label>
                        </div>
                        <input id="job_title" placeholder="Nhập tiêu đề tin" type="text">
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="level_type">
                                <span class="color-alert">*</span> Cấp bậc :
                            </label>
                        </div>
                        <select id="level_type">
                            <option></option>
                            <% if (levelList && levelList.length > 0) { %>
                                <% levelList.forEach(function(item, index) { %>
                                    <% for (const key in item) { %>
                                        <option value="<%= key %>"><%= item[key] %></option>
                                    <% } %>
                                <% }); %>
                            <% } %>
                        </select>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="exp_id">
                                <span class="color-alert">*</span> Kinh nghiệm :
                            </label>
                        </div>
                        <select id="exp_id">
                            <option></option>
                            <% if (listSizeExp && listSizeExp.length > 0) { %>
                                <% listSizeExp.forEach(function(item, index) { %>
                                    <% for (const key in item) { %>
                                        <option value="<%= key %>"><%= item[key] %></option>
                                    <% } %>
                                <% }); %>
                            <% } %>
                        </select>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="cat_id">
                                <span class="color-alert">*</span> Ngành nghề :
                            </label>
                        </div>
                        <select id="cat_id" name="cat_box[]" multiple="multiple">
                            <option></option>
                            <% if (cateList && cateList.length > 0) { %>
                                <% cateList.forEach(function(item) { %>
                                    <option value="<%= item.cat_id %>"><%= item.cat_name %></option>
                                <% }); %>
                            <% }  %>
                        </select>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="city_job">
                                <span class="color-alert">*</span> Thành phố  :
                            </label>
                        </div>
                        <select id="city_job">
                            <option></option>
                            <% if (listCities && listCities.length > 0) { %>
                                <% listCities.forEach(function(item) { %>
                                    <option value="<%= item.cit_id %>"><%= item.cit_name %></option>
                                <% }); %>
                            <% }  %>
                        </select>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="distric_job">
                                <span class="color-alert">*</span> Quận / Huyện  :
                            </label>
                        </div>
                        <select id="distric_job">
                            <option></option>
                        </select>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="add_job">
                                <span class="color-alert">*</span> Địa chỉ chi tiết :
                            </label>
                        </div>
                        <input id="add_job" placeholder="Nhập địa chỉ chi tiết" type="text">
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="deadline_cv">
                                <span class="color-alert">*</span> Hạn nộp :
                            </label>
                        </div>
                        <input id="deadline_cv" type="date" placeholder="dd/mm/yyyy" min="<%= new Date().toISOString().slice(0, 10) %>">
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="typew_id">
                                <span class="color-alert">*</span> Hình thức làm việc :
                            </label>
                        </div>
                        <select id="typew_id">
                            <option></option>
                            <% if (listTypeWork && listTypeWork.length > 0) { %>
                                <% listTypeWork.forEach(function(item, index) { %>
                                    <% for (const key in item) { %>
                                        <option value="<%= key %>"><%= item[key] %></option>
                                    <% } %>
                                <% }); %>
                            <% } %>
                        </select>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="cmi_id">
                                <span class="color-alert">*</span> Hoa hồng :
                            </label>
                        </div>
                        <input id="cmi_id" placeholder="VD: 25%, 35%, ..." type="text">
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="trial_job">
                                <span class="color-alert">*</span> Thời gian thử việc :
                            </label>
                        </div>
                        <input id="trial_job" placeholder="VD: 3 tuẩn, 5 tuần, ..." type="text">
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="monyr_id">
                                <span class="color-alert">*</span> Mức lương :
                            </label>
                        </div>
                        <select id="monyr_id">
                            <option></option>
                            <% if (listRangeMoney && listRangeMoney.length > 0) { %>
                                <% listRangeMoney.forEach(function(item, index) { %>
                                    <% for (const key in item) { %>
                                        <option value="<%= key %>"><%= item[key] %></option>
                                    <% } %>
                                <% }); %>
                            <% } %>
                        </select>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="nbpos_job">
                                <span class="color-alert">*</span> Số lượng cần tuyển :
                            </label>
                        </div>
                        <input id="nbpos_job" placeholder="Nhập số lượng cần tuyển" type="text">
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="edu_id">
                                <span class="color-alert">*</span> Bằng cấp :
                            </label>
                        </div>
                        <select id="edu_id">
                            <option></option>
                            <% if (listEdu && listEdu.length > 0) { %>
                                <% listEdu.forEach(function(item, index) { %>
                                    <% for (const key in item) { %>
                                        <option value="<%= key %>"><%= item[key] %></option>
                                    <% } %>
                                <% }); %>
                            <% } %>
                        </select>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="gen_id">
                                <span class="color-alert">*</span> Giới tính :
                            </label>
                        </div>
                        <select id="gen_id">
                            <option></option>
                            <% if (genderList && genderList.length > 0) { %>
                                <% genderList.forEach(function(item, index) { %>
                                    <% for (const key in item) { %>
                                        <option value="<%= key %>"><%= item[key] %></option>
                                    <% } %>
                                <% }); %>
                            <% } %>
                        </select>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="des_job">
                                <span class="color-alert">*</span> Mô tả công việc :
                            </label>
                        </div>
                        <textarea id="des_job" placeholder="Nhập mô tả" type="text"></textarea>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="job_req">
                                <span class="color-alert">*</span> Yêu cầu công việc :
                            </label>
                        </div>
                        <textarea id="job_req" placeholder="Nhập yêu cầu" type="text"></textarea>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="bene_job">
                                <span class="color-alert">*</span> Quyền lợi được hưởng :
                            </label>
                        </div>
                        <textarea id="bene_job" placeholder="Nhập quyền lợi" type="text"></textarea>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="required_cv">
                                <span class="color-alert">*</span> Yêu cầu hồ sơ :
                            </label>
                        </div>
                        <textarea id="required_cv" placeholder="Nhập yêu cầu hồ sơ" type="text"></textarea>
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="name_ctc">
                                <span class="color-alert">*</span> Người liên hệ :
                            </label>
                        </div>
                        <input id="name_ctc" placeholder="Nhập người liên hệ" type="text">
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="add_ctc">
                                <span class="color-alert">*</span> Địa chỉ liên hệ :
                            </label>
                        </div>
                        <input id="add_ctc" placeholder="Nhập địa chỉ liên hệ" type="text">
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="phone_ctc">
                                <span class="color-alert">*</span> Số điện thoại liên hệ :
                            </label>
                        </div>
                        <input id="phone_ctc" placeholder="Nhập số điện thoại liên hệ" type="text">
                    </div>
                    <div class="add-item">
                        <div class="label-item fw-600">
                            <label for="ema_ctc">
                                <span class="color-alert">*</span> Email liên hệ :
                            </label>
                        </div>
                        <input id="ema_ctc" placeholder="Nhập Email liên hệ" type="email">
                    </div>
                </div>
                <div class="form-act">
                    <button id="create_emp">
                        Tạo mới
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="/js/jquery.min.js"></script>
<script>
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    function formatDate(dateString) {
        var date = new Date(dateString * 1000);
        var day = String(date.getDate()).padStart(2, '0');
        var month = String(date.getMonth() + 1).padStart(2, '0');
        var year = date.getFullYear();
        return `${day}/${month}/${year}`;
    }
    function formatDateTime(date, startOfDay = true) {
        const pad = (num) => String(num).padStart(2, '0');
        const day = pad(date.getDate());
        const month = pad(date.getMonth() + 1);
        const year = date.getFullYear();
        const hour = startOfDay ? '00' : '23';
        const minute = startOfDay ? '00' : '59';
        const second = startOfDay ? '00' : '59';
        const millisecond = startOfDay ? '000' : '999';
        return `${year}-${month}-${day}T${hour}:${minute}:${second}.${millisecond}`;
    }
    function deleteCookie(name) {
        document.cookie = name + '=; Max-Age=0; path=/;';
    }
    function logout() {
        deleteCookie('adminToken');
        deleteCookie('adminRefToken');
        deleteCookie('adm_id');
        deleteCookie('adm_name');
        deleteCookie('adm_email');
        deleteCookie('adm_phone');
        deleteCookie('adm_bophan');
        deleteCookie('id_bophankd');
        deleteCookie('adm_picture');
        deleteCookie('typeadmin');
        deleteCookie('isLogin');
        deleteCookie('confirmBoxSeen')
        window.location.href = '/admin';
    }
</script>
<script src="/js/custom_select2.js"></script>
<script>
    $(document).ready(function(){
        $('#level_type').CustomSelect({
            placeholder: 'Chọn cấp bậc',
            searchPlaceholder: 'Tìm kiếm...'
        });
        $('#cat_id').CustomSelect({
            placeholder: 'Chọn ngành nghề',
            searchPlaceholder: 'Tìm kiếm...',
            multiple: true,  // Cho phép chọn nhiều tùy chọn
            maxItems: 3
        });
        $('#city_job').CustomSelect({
            placeholder: 'Chọn tỉnh thành',
            searchPlaceholder: 'Tìm kiếm...'
        });
        $('#exp_id').CustomSelect({
            placeholder: 'Chọn kinh nghiệm',
            searchPlaceholder: 'Tìm kiếm...'
        });
        $('#gen_id').CustomSelect({
            placeholder: 'Chọn giới tính',
            searchPlaceholder: 'Tìm kiếm...'
        });
        $('#edu_id').CustomSelect({
            placeholder: 'Chọn bằng cấp',
            searchPlaceholder: 'Tìm kiếm...'
        });
        $('#typew_id').CustomSelect({
            placeholder: 'Chọn hình thức làm việc',
            searchPlaceholder: 'Tìm kiếm...'
        });
        $('#monyr_id').CustomSelect({
            placeholder: 'Chọn mức lương',
            searchPlaceholder: 'Tìm kiếm...'
        });
        $('#distric_job').CustomSelect({
            placeholder: 'Chọn quận / huyện',
            searchPlaceholder: 'Tìm kiếm...'
        });
        $('#city_job').change(function() {
            var id = parseInt($(this).val());
            $.ajax({
                url: '/api/getDistrict',
                method: 'POST',
                data: { id: id },
                success: function(response) {
                    if (response.district.length > 0) {
                        $('#distric_job').empty();
                        response.district.forEach(function(city) {
                            $('#distric_job').append('<option value="' + city.cit_id + '">' + city.cit_name + '</option>');
                        });

                        $('#distric_job').trigger('update');
                        
                    }
                },
                error: function(err) {
                    console.error('Error:', err);
                }
            });
        });

    })
    $(document).ready(function() {
    $('#create_emp').click(function() {
        function getSelectedValuesById(selectId) {
            var selectedValues = [];
            
            var containerSelector = '#' + selectId + ' + .custom-select-wrapper .selected-options-container';
            
            $(containerSelector + ' .selected-option').each(function() {
                var value = $(this).data('value');
                selectedValues.push(value);
            });
            
            return selectedValues;
        }
        var confirmed = confirm('Xác nhận tạo bài viết');
        if (confirmed) {
            var emp_id = $('#emp_id').val();
            var job_title = $('#job_title').val();
            var level_type = $('#level_type').val();
            var cat_id = getSelectedValuesById('cat_id');
            var city_job = $('#city_job').val();
            var distric_job = $('#distric_job').val();
            var typew_id = $('#typew_id').val();
            var cmi_id = $('#cmi_id').val();
            var trial_job = $('#trial_job').val();
            var monyr_id = $('#monyr_id').val();
            var nbpos_job = $('#nbpos_job').val();
            var edu_id = $('#edu_id').val();
            var gen_id = $('#gen_id').val();
            var des_job = $('#des_job').val();
            var job_req = $('#job_req').val();
            var bene_job = $('#bene_job').val();
            var required_cv = $('#required_cv').val();
            var name_ctc = $('#name_ctc').val();
            var add_ctc = $('#add_ctc').val();
            var phone_ctc = $('#phone_ctc').val();
            var ema_ctc = $('#ema_ctc').val();
            var add_job = $('#add_job').val();
            var exp_id = $('#exp_id').val();
            var deadline_cv = $('#deadline_cv').val();

            // Create data object
            var data = {
                'new_user_id': emp_id,
                'new_title': job_title,
                'new_cap_bac': level_type,
                'new_cat_id': cat_id.join(','),
                'new_city': city_job,
                'new_qh_id': distric_job,
                'new_addr': add_job,
                'new_hoahong': cmi_id,
                'new_thuviec': trial_job,
                'new_so_luong': nbpos_job,
                'new_exp': exp_id,
                'new_bang_cap': edu_id,
                'new_gioi_tinh': gen_id,
                'new_han_nop': deadline_cv,
                'new_mota': des_job,
                'new_yeucau': job_req,
                'new_quyenloi': bene_job,
                'new_ho_so': required_cv,
                'new_usercontact': name_ctc,
                'new_addcontact': add_ctc,
                'new_phonecontact': phone_ctc,
                'new_emailcontact': ema_ctc,
                'new_money': monyr_id,
                'new_money_type': 0,
                'new_money_from': 0,
                'new_money_to': 0,
                'new_TAG': "",
                'new_hinh_thuc': typew_id
            };

            // Log the data object
            console.log(data);

            // Send AJAX request
            $.ajax({
                url: 'http://localhost:3057/api/topcv1s/admin/CreateNew',
                method: 'POST',
                data: JSON.stringify(data),
                contentType: 'application/json',
                headers: {
                    "Authorization": "Bearer " + getCookie('adminToken')
                },
                success: function(response) {
                    if (response && response.data && response.data.message) {
                        alert(response.data.message);
                    } else {
                        alert('Tạo thành công');
                    }
                },
                error: function(xhr, status, error) {
                    var errMsg = 'Đã xảy ra lỗi.';
                    try {
                        var response = JSON.parse(xhr.responseText);
                        if (response && response.error) {
                            errMsg = response.error.message || 'Lỗi không xác định.';
                        }
                    } catch (e) {
                        errMsg = "Đã xảy ra lỗi";
                    }
                    alert(errMsg);
                }
            });
        }
    });
});

</script>
</html>
