<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý chung</title>
    <link rel="icon" href="/images/img/default_logo.jpg">
    <link rel="stylesheet" href="/css/uv/manahome_uv.css" as="style" >
    <link rel="stylesheet" href="/css/common.css" as="style" >
    <link rel="stylesheet" href="/css/leftnav_uv.css" as="style" >
    <link rel="stylesheet" href="/css/header_uv.css" as="style" >
    <link rel="stylesheet" href="/css/footer.css" as="style" >
    <script src="/js/jquery.min.js"></script>
</head>

<body>
    <div class="cnt">
        <div class="cnt-left" id="leftNav">
            <%- include('../layouts/leftnav_uv', {}); %>
        </div>
        <div class="cnt-right" id="rightContent">
            <%- include('../layouts/header_uv', {}); %>
            <div class="cnt-body d-flex flex-dr-c">
                <div class="cnt-supp bg-white d-flex justify-b fw-600 gap-2">
                    <img class="rounded-circle cnt-supp-avar" src="/images/img/cskh_image.jpg" width="114px"
                        height="114px" alt="Customer Service Image">
                    <div class="cnt-supp-name">
                        <span>Chuyên viên hỗ trợ:</span>
                        <span class="color-main"> Mrs. Nguyễn Hồng</span>
                    </div>
                    <div class="cnt-supp-phone">
                        <span>SĐT - Zalo:</span>
                        <span class="color-main"> 0123456789</span>
                    </div>
                    <div class="cnt-supp-mail">
                        <span>Email:</span>
                        <span class="color-alert"> nguyenhongg2609@gmail.com</span>
                    </div>
                </div>
                <div class="cnt-sts">
                    <div class="cnt-sts-appd">
                        <div class="cnt-sts-left">
                            <div class="cnt-sts-tit">
                                Đã ứng tuyển
                            </div>
                            <img width="72" height="72" src="/images/img/handshake_2618623.svg" alt="Job Applied">
                        </div>
                        <div class="cnt-sts-rig">
                            <%= dataFromAPI.data.daUngTuyen %>
                        </div>
                    </div>
                    <div class="cnt-sts-suit">
                        <div class="cnt-sts-left">
                            <div class="cnt-sts-tit">
                                Việc làm phù hợp
                            </div>
                            <img width="67" height="67" src="/images/img/research_8769044.svg" alt="Suitable Jobs">
                        </div>
                        <div class="cnt-sts-rig">
                            <%= dataFromAPI.data.cout_viecLamPhuHop %>
                        </div>
                    </div>
                    <div class="cnt-sts-cv">
                        <div class="cnt-sts-left">
                            <div class="cnt-sts-tit">
                                Mẫu CV đã tạo
                            </div>
                            <img width="71" height="71" src="/images/img/cv_3135731.svg" alt="Created CV">
                        </div>
                        <div class="cnt-sts-rig">
                            <%= dataFromAPI.data.mauCvDaTao %>
                        </div>
                    </div>
                    <div class="cnt-sts-empv">
                        <div class="cnt-sts-left">
                            <div class="cnt-sts-tit">
                                NTD đã xem hồ sơ
                            </div>
                            <img width="70" height="70" src="/images/img/folder_3919868.svg" alt="Number Viewing ">
                        </div>
                        <div class="cnt-sts-rig">
                            <%= dataFromAPI.data.xemHoSo %>
                        </div>
                    </div>
                </div>
                <div class="cnt-suit bg-white">
                    <div class="cnt-suit-tit fw-4 fw-600 color-main">
                        VIỆC LÀM PHÙ HỢP
                    </div>
                    <div class="cnt-suit-list">
                        <% if (dataFromAPI.data.viecLamPhuHop && dataFromAPI.data.viecLamPhuHop.length > 0) { %>
                            <% dataFromAPI.data.viecLamPhuHop.forEach(function(item) { %>
                                <div class="item">
                                    <div class="item-lef">
                                        <img class="rounded-circle item-logo" onerror="this.onerror=null;this.src='/images/img/default_logo.jpg';" width="85" height="85"  src="<%= item.usc_logo %>" alt="<%= item.new_title %>">
                                    </div>
                                    <div class="item-rig">
                                        <div class="item-cnt">
                                            <div class="fw-700 color-main item-tit">
                                                <a href="/<%= item.new_alias %>-<%= item.new_id %>"><%= item.new_title %></a>
                                            </div>
                                            <div class="fs-7 item-des">
                                                <a href="/<%= item.usc_alias %>">
                                                    <%= item.usc_company %>
                                                </a>                                           
                                            </div>
                                            <div class="item-inf">
                                                <% if (item.new_city && item.new_city.length > 0) { %>
                                                    <% item.new_city.forEach(function(city) { %>
                                                        <div class="item-sal">
                                                            <%= city %>
                                                        </div>
                                                    <% }); %>
                                                <% } %>
                                                <div class="item-add">
                                                    <%= getMucLuong(item.new_money_type,item.new_money_from,item.new_money_to,item.new_money) %>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="item-save <%= item.checkSave == true ? 'saved' : '' %>" save_target ='<%= item.new_id %>'>
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M12.7843 17.0976L12.7826 17.0963C12.196 16.6503 11.384 16.6503 10.7974 17.0963L6.4675 20.3862L6.46739 20.386L6.45674 20.3946C6.28583 20.532 6.05282 20.5633 5.85173 20.4758C5.6554 20.3904 5.52113 20.2055 5.5 19.9933V5.96659C5.5353 5.2794 5.84161 4.63405 6.35205 4.17215C6.86526 3.70774 7.54246 3.46713 8.23364 3.50362L8.24681 3.50431H8.26H15.26H15.2714L15.2828 3.50379C15.9782 3.47202 16.6572 3.72039 17.168 4.19331C17.6769 4.66454 17.9764 5.3195 18 6.01248V19.9856C17.9725 20.1876 17.8424 20.3617 17.6553 20.445C17.4631 20.5305 17.2399 20.5072 17.0696 20.384L12.7843 17.0976Z" stroke="#00b14f"/>
                                            </svg>                                                
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        <% } else { %>
                            Không có việc làm phù hợp 
                        <% } %>
                    </div>
                    <div class="cnt-suit-more d-flex justify-c">
                        <a href="/" class="more-btn">Xem thêm</a>
                    </div>
                </div>
                <div class="cnt-cv d-flex">
                    <div class="cnt-cv-lis">
                        <div class="cnt-cv-tit fw-600 fs-4 color-main">
                            DANH SÁCH CV CỦA TÔI
                        </div>
                        <div class="cv-slide">
                            <% if (dataFromAPI.data.CvCuaToi && dataFromAPI.data.CvCuaToi.length > 0) { %>
                                <% dataFromAPI.data.CvCuaToi.forEach(function(item) { %>
                                    <div class="cv-item">
                                        <img src="<%= item.name_cv %>" alt="<%= item.idcv %>">
                                    </div>
                                <% }); %>
                            <% } %>
                        </div>
                        <a href="/uv/quan-ly-cv-xin-viec" class="cnt-cv-lis-more color-main fw-600 fs-4 d-flex justify-c gap-1 align-c">
                            Xem tất cả<img src="/images/icon/more_icon.svg" width="22" height="22" alt="More Icon">
                        </a>
                    </div>
                    <div class="cnt-cv-rec">
                        <div class="cnt-cv-tit fw-600 fs-4 color-main">
                            MẪU CV ĐỀ XUẤT
                        </div>
                        <div class="cv-slide">
                            <% if (dataFromAPI.data.mauCvDeXuat && dataFromAPI.data.mauCvDeXuat.length > 0) { %>
                                <% dataFromAPI.data.mauCvDeXuat.forEach(function(item) { %>
                                    <div class="cv-item">
                                        <img src="<%= item.image %>" alt="<%= item.name %>">
                                    </div>
                                <% }); %>
                            <% } %>
                        </div>
                        <a href="/cv-xin-viec" class="cnt-cv-rec-more color-main fw-600 fs-4 d-flex justify-c gap-1 align-c">
                            Xem tất cả<img src="/images/icon/more_icon.svg" width="22" height="22" alt="More Icon">
                        </a>
                    </div>
                </div>
                <div class="cnt-tip bg-white">
                    <div class="cnt-tip-tit fw-600 fs-4 color-main">
                        BÍ QUYẾT VIẾT CV
                    </div>
                    <div class="cnt-lis-blg">
                        <% if (dataFromAPI.data.camNangTimViec && dataFromAPI.data.camNangTimViec.length > 0) { %>
                            <% dataFromAPI.data.camNangTimViec.forEach(function(item) { %>
                                <div class="cnt-blg">
                                    <a href="<%= item.new_title_rewrite %>">
                                        <img src="<%= item.new_picture %>" onerror="this.onerror=null;this.src='/images/img/default_logo.jpg';" alt="<%= item.new_title %>">
                                    </a>
                                    <span>
                                        <a href="<%= item.new_title_rewrite %>"><%= item.new_title %></a>
                                    </span>
                                </div>
                            <% }); %>
                        <% } %>
                    </div>
                    <a href="/tin-tuc" class="cnt-lis-blg-more color-main fw-600 fs-4 d-flex justify-c gap-1 align-c">
                        Xem tất cả<img src="/images/icon/more_icon.svg" width="22" height="22" alt="More Icon">
                    </a>
                </div>
            </div>
        </div>
    </div>
    <%- include('../layouts/footer', {}); %>
    <script>
        $(document).ready(function () {
            var $leftNav = $('.lnav');
            var $rightContent = $('#rightContent');
            var rightContentHeight = $rightContent.outerHeight(true);
            var leftNavHeight = $leftNav.outerHeight(true);
    
            if (leftNavHeight > rightContentHeight) {
                $leftNav.css({
                    position: 'static'
                });
                $rightContent.css({
                    'margin-left': '0'
                });
            } else {
                $(window).scroll(function () {
                    var rightContentOffsetTop = $rightContent.offset().top;
                    var rightContentBottom = rightContentOffsetTop + rightContentHeight;
                    var scrollTop = $(window).scrollTop();
                    var windowHeight = $(window).height();
    
                    if (scrollTop + leftNavHeight > rightContentBottom) {
                        $leftNav.css({
                            position: 'absolute',
                            top: (rightContentHeight - leftNavHeight) + 'px'
                        });
                    } else {
                        $leftNav.css({
                            position: 'fixed',
                            top: '0'
                        });
                    }
                    $rightContent.css({
                        'margin-left': ''
                    });
                });
            }
        });
        $(document).ready(function() {
            $('.uhead-rig-togm').click(function() {
                $('#mobileMenu').slideDown(300);
            });
            $('.menu-mb-close').click(function() {
                $('#mobileMenu').slideUp(300);
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            $('.item-save').click(function(){
                $('.item-save').removeClass('target');
                $(this).addClass('target');
                var news_id = $(this).attr('save_target');
                if(!$(this).hasClass('saved')){
                    $.ajax({
                        url: 'http://localhost:3050/api/topcv1s/candidate/SaveNew',
                        type: 'POST',
                        contentType: 'application/json',
                        headers: {
                            "Authorization": "Bearer " + getCookie('accessToken')
                        },
                        data: JSON.stringify({
                            id_tin: news_id
                        }),
                        success: function(response) {
                            console.log(response);
                            alert('Lưu tin thành công');
                            $('.item-save.target').addClass('saved');
                            $('.item-save').removeClass('target');
                        },
                        error: function(error) {
                            if(error.responseJSON.message){
                                alert(error.responseJSON.message);
                            }
                            else{
                                alert('Có lỗi xảy ra, vui lòng thử lại');
                            }
                        }
                    });
                }
                else{
                    $.ajax({
                        url: 'http://localhost:3050/api/topcv1s/candidate/SaveNew',
                        type: 'POST',
                        contentType: 'application/json',
                        headers: {
                            "Authorization": "Bearer " + getCookie('accessToken')
                        },
                        data: JSON.stringify({
                            id_tin: news_id
                        }),
                        success: function(response) {
                            console.log(response);
                            alert('Hủy lưu tin thành công');
                            $('.item-save.target').removeClass('saved');
                            $('.item-save').removeClass('target');
                        },
                        error: function(error) {
                            if(error.responseJSON.message){
                                alert(error.responseJSON.message);
                            } else {
                                alert('Có lỗi xảy ra, vui lòng thử lại');
                            }
                            
                        }
                    });
                }
            })
            function getCookie(name) {
                var value = "; " + document.cookie;
                var parts = value.split("; " + name + "=");
                if (parts.length === 2) return parts.pop().split(";").shift();
            }
        })
    </script>
</body>

</html>