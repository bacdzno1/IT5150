function deletePop(){$("#imageEditorWraper_AI").hide(),$("#imageEditorWraper_AI .container").hide(),$("#imageEditorWraper_AI .avatar-container").show(),$(".choose_image .bottom-container .right-span, .choose_image_style .bottom-container .right-span").attr("data-class",""),$(".choose_image .image-container").show(),$(".avatar_handle").css({background:""}),$("input:checked").parent().css({border:"none"}),$("input:checked").attr("checked",!1),$("#inp_avatar_ai365").val(""),file_avatar="",file_style=""}function newCrop(){$("#imageEditorWraper .container h3:first-child").html("Chỉnh sửa ảnh phong cách"),$("#imageEditorWraper .editor-col-right h4").html("Phong cách CV"),$(".tipCompress").html("Lưu ý ảnh phong cách cần đủ sáng và nhìn thẳng")}function oldCrop(){$("#imageEditorWraper .container h3:first-child").html("Chỉnh sửa ảnh đại diện"),$("#imageEditorWraper .editor-col-right h4").html("Ảnh hiển thị trên CV"),$(".tipCompress").html("Nếu ảnh của bạn có dung lượng trên 5MB, vui lòng giảm dung lượng ảnh trước khi tải lên.")}function detectAvatar(a){$.ajax({url:"http://43.239.223.19:4090/detect",type:"POST",data:{source_image:a},beforeSend:function(a){$(".bg-spinner").remove(),$("body").append('<div class="bg-spinner"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div>')},success:function(e){$(".bg-spinner").remove(),e&&e.face?($(".choose_image .bottom-container .right-span").attr("data-class","profile_descripe"),$("#avatarAI365Wraper .box_select_info").show(),$(".choose_image .image-container").hide(),$(".choose_image .avatar_handle").css({background:`url(${a})`,"background-size":"contain","background-repeat":"no-repeat","background-position":"center center"})):($(".choose_image .warning_text").html("Ảnh không hợp lệ"),setTimeout((()=>{$(".choose_image .warning_text").html("Nếu ảnh của bạn có dung lượng trên 5MB, vui lòng giảm dung lượng ảnh trước khi tải lên.")}),2e3),$("#avatarAI365Wraper .box_select_image,#avatarAI365Wraper .box_des,#avatarAI365Wraper .box_select_info,#avatarAI365Wraper .box_select_style,#avatarAI365Wraper .box_render_success").hide())},error:function(a,e,t){console.log("failed")}})}function detectAvatarUpload(a){$.ajax({url:"/api/cv/detectFace",type:"POST",data:JSON.stringify({base64:a}),beforeSend:function(a){$(".bg-spinner").remove(),$("body").append('<div class="bg-spinner"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div>')},contentType:"application/json; charset=utf-8",success:function(e){const t=e?.data;$(".bg-spinner").remove(),t&&t.face?($("#imageEditorWraper").hide(),$("#imageEditorWraper_AI").show(),$(".choose_image_style").hide(),$(".choose_image").show(),$(".choose_image .image-container").hide(),image=a,$(".choose_image  .avatar_handle").css({"background-size":"contain","background-color":"#787878","background-image":`url(${a})`,"background-repeat":"no-repeat",border:"0.5px solid #979797"}),$(".choose_image .bottom-container .right-span").attr("data-class","profile_descripe ")):($(".tipCompress").html("Ảnh không hợp lệ"),setTimeout((()=>{$(".tipCompress").html("Lưu ý ảnh phong cách cần đủ sáng và nhìn thẳng")}),2e3))},error:function(a){console.log(a)}})}function downloadBase64(a,e){const t=document.createElement("a");t.href=a,t.download=`${e}.png`,t.click()}$((function(){window.URL||window.webkitURL;var a=$("#image"),e=($(".btn-save-image"),$("#dataX"),$("#dataY"),$("#dataHeight")),t=$("#dataWidth");$("#dataRotate"),$("#dataScaleX"),$("#dataScaleY"),$("#dataTile").val(),t.val(),e.val(),a.attr("src");function n(a,e,t,n){$.ajax({url:"/api/cv/dressUpAvatar",type:"POST",async:"false",data:{prompt_clothes:a,gender:e,clothes_type:t,image:n},beforeSend:function(e){$(".profile_descripe").hide(),$(".loading-container").show(),$(".avatar-final-container .clothes_option .clothes_text").attr("data-render",t),$(".avatar-final-container .clothes_option .dropdown-content p").find(`[data-render='${t}']`).addClass("active"),$(".avatar-final-container textarea").val(a)},success:function(a){const e=a?.data;let t=e;$(".loading-container").hide(),image_final_1=`data:image/jpeg;base64,${t?.b64_image_1}`,image_final_2=`data:image/jpeg;base64,${t?.b64_image_2}`,$(".avatar-final-container").show(),$(".avatar-final-container .avatar-show .left-avatar .handle-avatar").css({"background-image":`url(${image_final_1})`}),$(".avatar-final-container .avatar-show .left-avatar .handle-avatar").attr("data-image",image_final_1),$(".avatar-final-container .avatar-show .right-avatar .handle-avatar").css({"background-image":`url(${image_final_2})`}),$(".avatar-final-container .avatar-show .right-avatar .handle-avatar").attr("data-image",image_final_2)},error:function(a,e,t){console.log(t),window.alert("Có lỗi xảy ra!"),deletePop()}})}$('[data-toggle="tooltip"]').tooltip(),$.isFunction(document.createElement("canvas").getContext)||($('button[data-method="getCroppedCanvas"]').prop("disabled",!0),$("button.btn-save-image").prop("disabled",!0)),$(document).on("change","#inp_avatar_ai365",(function(a){let e=this.files[0];e&&uploadImageCut(e)})),$(document).on("dragover",".choose_image .avatar_handle",(function(a){a.preventDefault(),$(this).addClass("active")})),$(document).on("dragleave",".choose_image .avatar_handle",(function(a){a.preventDefault(),$(this).removeClass("active")})),$(document).on("drop",".choose_image .avatar_handle",(function(a){a.preventDefault(),$(this).removeClass("active"),result=a.originalEvent.dataTransfer.files[0],"image"!=result.type.split("/")[0]?($(".choose_image .warning_text").html("Vui lòng chọn ảnh"),setTimeout((()=>{$(".choose_image .warning_text").html("Nếu ảnh của bạn có dung lượng trên 5MB, vui lòng giảm dung lượng ảnh trước khi tải lên.")}),2e3)):(file_avatar=result,uploadImageCut(result))})),$(".profile_descripe .render_avatar").on("click",(function(a){gender=$(".profile_descripe .gender_option input:checked").attr("data-gender"),clothes_type=$(".profile_descripe .clothes_option .clothes_text").attr("data-render"),prompt_clothes=$(".profile_descripe textarea").val(),n(prompt_clothes,gender,clothes_type,image)})),$(".avatar-final-container .avatar_change").on("click",(function(a){gender=$(".profile_descripe .gender_option input:checked").attr("data-gender"),clothes_type=$(".avatar-final-container .clothes_option .clothes_text").attr("data-render"),prompt_clothes=$(".avatar-final-container textarea").val(),$(".avatar-final-container").hide(),n(prompt_clothes,gender,clothes_type,image)}))})),$(document).on("click","#cvo-profile-avatar, .fake_img",(function(){$(".isNewImage").val("no"),$("#imageEditorWraper").show()})),$(document).on("click",".delete_wraper, .choose_image .bottom-container .left-span",(function(a){deletePop()})),$(document).on("click",(function(a){$(a.target).closest(".avatar-container.container").length||"cvo-profile-avatar"===$(a.target).attr("id")||"imageEditorWraper"===$(a.target).attr("id")||$(a.target).closest(".container_crop_image").length||deletePop()})),$(document).on("click",(function(a){$(a.target).closest(".container_crop_image").length||"cvo-profile-avatar"===$(a.target).attr("id")||$(a.target).closest(".avatar-container.container").length||$("#imageEditorWraper").hide()})),$(document).on("click",".avatar-container .show_old_avatar",(function(a){oldCrop(),$(".isNewImage").val("no"),$("#imageEditorWraper_AI").hide(),$("#imageEditorWraper").show(),$(".edit-image-btns").css({display:"flex"})}));var file_avatar="",file_style="",avatar_final="";function getBase64(a){return new Promise(((e,t)=>{const n=new FileReader;n.readAsDataURL(a),n.onload=()=>e(n.result),n.onerror=a=>t(a)}))}$(document).on("dragover",".choose_image .avatar_handle",(function(a){a.preventDefault(),$(this).addClass("active")})),$(document).on("dragleave",".choose_image .avatar_handle",(function(a){a.preventDefault(),$(this).removeClass("active")})),$(document).on("drop",".choose_image .avatar_handle",(function(a){if(a.preventDefault(),$(this).removeClass("active"),result=a.originalEvent.dataTransfer.files[0],"image"!=result.type.split("/")[0])$(".choose_image .warning_text").html("Vui lòng chọn ảnh"),setTimeout((()=>{$(".choose_image .warning_text").html("Nếu ảnh của bạn có dung lượng trên 5MB, vui lòng giảm dung lượng ảnh trước khi tải lên.")}),2e3);else{file_avatar=result;getBase64(result).then((a=>{detectAvatar(a)}))}})),$(document).on("click",".choose_image .avatar_handle, .choose_image .avatar_change",(function(a){$("#inp_avatar_ai365").click()})),$(document).on("click",".profile_descripe .bottom-container .right-span",(function(a){let e=$('input[name="radio1"]:checked').attr("data-gender");null!=e&&($(this).parents(":eq(1)").hide(),$("#imageEditorWraper_AI .choose_image_style").show()),html="";for(let a=1;a<=6;a++)html+=`\n        <div class="image-ai-wraper" data-image="/images/avatar_cv/${e}/image_${a}.jpg?v=1" style = "background: url(https://devnext.timviec365.vn/static-tv/images/avatar_cv/${e}/image_${a}.jpg?v=1) no-repeat; background-size: cover;">\n        <div class="select-image-click"> </div>\n        </div>\n        `;$(".choose_image_style .image-ai-container .image-ai-wraper-container").html(html)})),$(document).on("click",".choose_image_2  .bottom-container .right-span",(function(a){imageSource=file_style,"images"!=imageSource.split("/")[1]?isBase64="true":isBase64="false";getBase64(file_avatar).then((a=>{$.ajax({url:"site/swapAvatar",type:"POST",data:{base64:a,imageSource:imageSource,isBase64:isBase64},beforeSend:function(a){$(".bg-spinner").remove(),$("body").append('<div class="bg-spinner"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div>')},dataType:"JSON",success:function(a){if($(".choose_image_2").hide(),$(".ai_image_created").show(),$(".bg-spinner").remove(),a&&a.result_image){let e=`data:image/jpeg;base64,${a.result_image}`;$(".ai_image_created .avatar_handle").css({background:`url(${e})`,"background-size":"cover"}),avatar_final=e}else $("#avatarAI365Wraper .box_image_error").show(),$("#avatarAI365Wraper .box_select_image,#avatarAI365Wraper .box_des,#avatarAI365Wraper .box_select_info,#avatarAI365Wraper .box_select_style,#avatarAI365Wraper .box_render_success").hide()}})}))})),$(document).on("click",".image_final_select, .ai_image_created .bottom-conatainer .right-span",(function(a){let e=avatar_final;$.ajax("https://job247.vn/api/work247/user/uploadAvatar",{method:"POST",data:{image64:e},cache:!1,beforeSend:function(a){$(".bg-spinner").remove(),$("body").append('<div class="bg-spinner"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div>')},success:function(a){$(".bg-spinner").remove(),$("#cvo-profile-avatar").attr("src",a),file_avatar="",deletePop()},error:function(){console.log("Upload error")}})})),$(document).on("click",".download_avatar",(function(a){downloadBase64(avatar_final,"cv365_avatar")})),$(".age_option > div, .gender_option > span").click((function(a){$(this).parent().find("span input, div input").attr("checked",!1),$(this).parent().find("span, div").css({border:"none"}),$(this).find("input").attr("checked",!0),$(this).css({border:"1.5px solid #4C5BD4"})})),$(document).on("click",".choose_type, .choose_tone",(function(){$(this).find(".dropdown-content").toggle()})),$(document).on("click",".choose_type .dropdown-content p, .choose_tone .dropdown-content p ",(function(){return text=$(this).html(),$(this).parents(":eq(1)").find("div:first-child").html(text),$(this).parent().find("p").removeClass("active"),$(this).addClass("active"),$(this).parent().hide(),!1})),$(document).on("click",".image-ai-wraper",(function(a){$(".image-ai-container .image-ai-wraper .select-image-click").removeClass("active"),$(this).find(".select-image-click").addClass("active"),image_source=$(this).attr("data-image"),file_style=image_source,$(".choose_image_2  .avatar_handle").css({background:`url(${image_source})`,"background-size":"cover"}),$(".choose_image_style .bottom-container .right-span").attr("data-class","choose_image_2")})),$(document).on("click",".choose_image_2 .avatar_change",(function(a){$(".choose_image_style").show(),$(this).parent().hide()})),$(document).on("click",".bottom-container span",(function(a){""!=$(this).attr("data-class")&&($(this).parents(":eq(1)").hide(),data_class=$(this).attr("data-class"),$(`.${data_class}.container`).show())})),$(document).on("click",".ai_image_created .image_option_wraper .image_change",(function(a){$(".ai_image_created ").hide(),$(".choose_image").show(),$(".choose_image .bottom-container .right-span, .choose_image_style .bottom-container .right-span").attr("data-class",""),$(".choose_image .image-container").show(),$(".avatar_handle").css({background:""}),$("input:checked").parent().css({border:"none"}),$("input:checked").attr("checked",!1),$("#inp_avatar_ai365").val(""),file_avatar="",file_style=""})),$(".gender_option > span").click((function(a){$(this).parent().find("span input").attr("checked",!1),$(this).parent().find("span, div").css({border:"none"}),$(this).find("input").attr("checked",!0),$(this).css({border:"1.5px solid #4C5BD4"})})),$(document).on("click",".clothes_option",(function(){$(this).parent().find(".dropdown-content").toggle()})),$(document).on("click",".clothes_option .dropdown-content p",(function(){return text=$(this).html(),data_render=$(this).attr("data-render"),$(".clothes_option .clothes_text").html(text),$(".clothes_option .clothes_text").attr("data-render",data_render),$(this).parent().find("p").removeClass("active"),$(this).addClass("active"),$(this).parent().hide(),!1})),$(document).on("click",".avatar-final-container .handle-avatar",(function(a){$(".avatar-final-container .handle-avatar .select-image-click").removeClass("active"),$(this).find(".select-image-click").addClass("active"),avatar_final=$(this).attr("data-image")})),$(document).on("click",".choose_image_2 .avatar_change",(function(a){$(".choose_image_style").show(),$(this).parent().hide()})),$(document).on("click",".bottom-container span",(function(a){""!=$(this).attr("data-class")&&($(this).parents(":eq(1)").hide(),data_class=$(this).attr("data-class"),$(`#imageEditorWraper_AI .${data_class}`).show())})),$(document).on("click","#imageEditorWraper_AI .delete_wraper",(function(a){deletePop()})),$(document).on("click","#imageEditorWraper_AI .choose_image .bottom-container .left-span",(function(a){$("#imageEditorWraper_AI .container").hide(),$("#imageEditorWraper_AI .avatar-container").show()}));